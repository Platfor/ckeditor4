<!DOCTYPE html>
<!--
Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
-->
<html>
<head>
	<meta charset="UTF-8">
	<title>Get Clipboard HTML and RTF</title>
	<style>

		textarea {
			border: 1px solid #808080;
			float: left;
			height: 200px;
			width: 100%;
			overflow: auto;
			margin-bottom: 20px;;
		}
		label {
			display: block;
			line-height: 2;
		}
		span {
			background-color: #88FFAA;
		}
		.marker {
			background-color: #FF9999;
		}
	</style>
	<script src="../../ckeditor.js"></script>
</head>
<body>
	<p>Paste Inside the Editor:</p>
	<div id="editor">
		<textarea id="input"></textarea>
	</div>
	<div>
		<div style="float: left; width: 49%">
			<p>Raw HTML Data Received: <span id="emHtml"></span></p>
			<textarea data-name="input.html" id="rawHtml" readonly="readonly"></textarea>
			<button id="htmlData">Save HTML Data</button>
		</div>
		<div style="float: right; width: 49%">
			<p>Raw RTF Data Received: <span id="emRtf"></span></p>
			<textarea data-name="input.rtf" id="rawRtf" readonly="readonly"></textarea>
			<button id="rtfData">Save RTF Data</button>
		</div>
	</div>
	<div style="width: 100%; float: left;">
		<p>After Paste Processing:</p>
		<textarea id="output" readonly="readonly"></textarea>
	</div>

	<div id="configuration">
		<p>Editor configuration:</p>

		<div>
			<button id="update">Update editor</button>
		</div>
		<div id="acf">
			<label><input type="checkbox" id="allowedContent"> Allow all content</label>
			<label>Extra allowed content: <input type="text" id="extraAllowedContent"></label>
		</div>
		<div id="editable"></div>
		<div id="paste"></div>
		<div id="basic"></div>
		<div id="image"></div>
		<div id="other"></div>
	</div>

	<script>
	var editablePlugins = [
			'wysiwygarea',
			'divarea'
		],
		pastePlugins = [
			'pastefromword',
			'pastefromlibreoffice',
			'pastefromgdocs',
			'pastetext'
		],
		basicPlugins = [
			'toolbar',
			'undo',
			'removeformat',
			'resize',
			'maximize',
			'showborders',
			'elementspath',
			'htmlwriter',
			'sourcearea',
			'clipboard',
			'pastetools'
		],
		imagePlugins = [
			'image',
			'image2',
			'easyimage'
		],
		otherPlugins = [
			'adobeair',
			'autoembed',
			'autolink',
			'basicstyles',
			'bidi',
			'blockquote',
			'codesnippet',
			'colorbutton',
			'copyformatting',
			'div',
			'docprops',
			'embed',
			'emoji',
			'enterkey',
			'entities',
			'flash',
			'font',
			'format',
			'forms',
			'horizontalrule',
			'iframe',
			'indent',
			'indentblock',
			'indentlist',
			'justify',
			'language',
			'link',
			'list',
			'listblock',
			'liststyle',
			'magicline',
			'mathjax',
			'pagebreak',
			'placeholder',
			'smiley',
			'specialchar',
			'stylescombo',
			'tab',
			'table',
			'tabletools'
		];

	generateUI( {
		container: 'editable',
		title: 'Editable plugins',
		plugins: editablePlugins,
		selectAll: false
	} );
	generateUI( {
		container: 'paste',
		title: 'Paste plugins',
		plugins: pastePlugins,
		selectAll: true
	} );
	generateUI( {
		container: 'basic',
		title: 'Basic plugins',
		plugins: basicPlugins,
		selectAll: true
	} );
	generateUI( {
		container: 'image',
		title: 'Image plugins',
		plugins: imagePlugins,
		selectAll: false
	} );
	generateUI( {
		container: 'other',
		title: 'Other plugins',
		plugins: otherPlugins,
		selectAll: true
	} );

	updateEditor();

	CKEDITOR.document.getById( 'update' ).on( 'click', updateEditor );

	var rtfButton = document.getElementById( 'rtfData' ),
		htmlButton = document.getElementById( 'htmlData' );

	rtfButton.onclick = save( document.getElementById( 'rawRtf' ) );
	htmlButton.onclick = save( document.getElementById( 'rawHtml' ) );

	function save( input ) {
		return function() {
			var textBlob = new Blob( [ input.value ], { type: 'text/plain' } );
			var saveLink = document.createElement( 'a' );

			saveLink.download = input.dataset.name;
			saveLink.innerHTML = 'Save file';
			if ( CKEDITOR.env.webkit ) {
				saveLink.href = window.URL.createObjectURL( textBlob );
			} else {
				saveLink.href = window.URL.createObjectURL( textBlob );
				saveLink.onclick = function( evt ) {
					document.body.removeChild( evt.target )
				};
				saveLink.style.display = 'none';
				document.body.appendChild( saveLink );
			}
			saveLink.click();
		}
	}

	function generateUI( options ) {
		var container = CKEDITOR.document.getById( options.container ),
			checkboxes = generateOptions( options.plugins, options.selectAll ),
			title = CKEDITOR.dom.element.createFromHtml( '<p>' + options.title + '</p>' );

		container.append( title );
		container.append( checkboxes );

		function generateOptions( options, selectAll ) {
			const optionsContainer = new CKEDITOR.dom.element( 'div' );

			CKEDITOR.tools.array.forEach( options, function( option, i ) {
				var checkbox = CKEDITOR.dom.element.createFromHtml( '<label><input type="checkbox" class="plugin" value="' + option + '"' + ( selectAll || i === 0 ? ' checked' : '' ) + '> ' + option + '</label>' );

				optionsContainer.append( checkbox );
			} );

			return optionsContainer;
		}
	}
	var currentInstance;

	function updateEditor() {
		var plugins = CKEDITOR.document.find( '.plugin:checked' ).toArray(),
			editorContainer = CKEDITOR.document.getById( 'editor' ),
			oldInstance = currentInstance;

		plugins = CKEDITOR.tools.array.map( plugins, function( plugin ) {
			return plugin.getValue();
		} );

		if ( oldInstance ) {
			oldInstance.once( 'destroy', function() {
				setTimeout( createEditor, 500 );
			} );

			return oldInstance.destroy( true );
		}

		createEditor();

		function createEditor() {
			var textarea = new CKEDITOR.dom.element( 'textarea' ),
				allowedContent = CKEDITOR.document.getById( 'allowedContent' ),
				extraAllowedContent = CKEDITOR.document.getById( 'extraAllowedContent' ),
				config = {
					language: 'en',
					embed_provider: 'https://ckeditor.iframe.ly/api/oembed?url={url}&callback={callback}',
					cloudServices_uploadUrl: 'https://33333.cke-cs.com/easyimage/upload/',
					// Note: this is a token endpoint to be used for CKEditor 4 samples / developer tests only. Images uploaded using the testing token service may be deleted automatically at any moment.
					// To create your own token URL please visit https://ckeditor.com/ckeditor-cloud-services/.
					cloudServices_tokenUrl: 'https://33333.cke-cs.com/token/dev/ijrDsqFix838Gh3wGO3F77FSW94BwcLXprJ4APSp3XQ26xsUHTi0jcb1hoBt',
					mathJaxLib: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_HTML',
					plugins: plugins
				};

			if ( allowedContent.$.checked ) {
				config.allowedContent = true;
			}

			if ( extraAllowedContent.getValue() ) {
				config.extraAllowedContent = extraAllowedContent.getValue();
			}

			editorContainer.setHtml( '' );
			editorContainer.append( textarea );

			var editor = CKEDITOR.replace( textarea, config );

			editor.on( 'paste', function( evt ) {
				// Clipboard text/html processing.
				var val = evt.data.dataValue;
				if ( evt.data.dataTransfer && evt.data.dataTransfer.getData( 'text/html', true ) ) {
					val = evt.data.dataTransfer.getData( 'text/html', true );
					document.getElementById( 'emHtml' ).innerHTML = '<br />Data from: <code>dataTransfer.getData( \'text/html\', true )</code>.';
				} else {
					document.getElementById( 'emHtml' ).innerHTML = '<br /><code>dataTransfer.getData( \'text/html\', true )</code> was empty.' +
					'<br /><span class="marker">Data from: <code>evt.data.dataValue</code>.</span>';
				}
				document.getElementById( 'rawHtml' ).value = val;

				// Clipboard text/rtf processing.
				val = '';
				if ( evt.data.dataTransfer && evt.data.dataTransfer.getData( 'text/rtf' ) ) {
					val = evt.data.dataTransfer.getData( 'text/rtf', true );
					document.getElementById( 'emRtf' ).innerHTML = '<br />Data from: <code>dataTransfer.getData( \'text/rtf\', true )</code>.';
				} else {
					document.getElementById( 'emRtf' ).innerHTML = '<br /><code>dataTransfer.getData( \'text/rtf\', true )</code> was empty';
				}
				document.getElementById( 'rawRtf' ).value = val;

			}, null, null, -1 );

			editor.on( 'paste', function( evt ) {
				setTimeout( function() {
					document.getElementById( 'output' ).value = editor.getData();
				}, 0 );
			}, null, null, 999 );
		}
	}

	</script>
</body>
</html>
